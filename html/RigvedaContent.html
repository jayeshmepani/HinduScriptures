<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ṛgveda Content</title>
  <link rel="icon" type="image/x-icon" href="/download.png">
  <style>
    * {
      scrollbar-width: none;
      -ms-overflow-style: none;

      &::-webkit-scrollbar {
        display: none;
      }
    }

    :root {
      --primary-color: #3b5998;
      --secondary-color: #8b9dc3;
      --accent-color: #ffcb6b;
      --text-light: #f0f0f5;
      --text-muted: #dfe3ee;
      --bg-main-start: hsla(225, 50%, 15%, 0.95);
      --bg-main-end: hsla(230, 60%, 10%, 0.9);
      --bg-container: rgba(20, 30, 55, 0.85);
      --bg-element: rgba(30, 45, 70, 0.9);
      --border-color: rgba(139, 157, 195, 0.3);
      --shadow-color: rgba(0, 0, 0, 0.3);
      --min-font-size: 0.8rem;
      --max-font-size: 1rem;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: var(--text-light);
      margin: 0;
      padding: 0;
      line-height: 1.6;
      font-size: clamp(var(--min-font-size), calc(var(--min-font-size) + 0.5vw), var(--max-font-size));
      background: linear-gradient(var(--bg-main-start), var(--bg-main-end)),
        url('/images/bg.png') center/cover fixed no-repeat;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100dvh;
      width: 100%;
      overflow: auto;
      box-sizing: border-box;
    }

    .page-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 950px;
      padding: 20px;
      box-sizing: border-box;
    }

    .header-controls {
      background-color: var(--bg-container);
      padding: 20px 25px;
      border-radius: 12px;
      box-shadow: 0 5px 20px var(--shadow-color);
      width: 100%;
      margin-bottom: 25px;
      border: 1px solid var(--border-color);

      h1#vedaTitle {
        color: var(--accent-color);
        text-align: center;
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 2em;
        font-weight: 600;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.4);
      }

      .search-area {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        align-items: center;

        input[type="search"] {
          flex-grow: 1;
          padding: 12px 18px;
          border-radius: 8px;
          border: 1px solid var(--border-color);
          background-color: var(--bg-element);
          color: var(--text-light);
          font-size: 0.95em;
          transition: all 0.3s ease;

          &:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px hsla(43, 100%, 71%, 0.3);
            background-color: rgba(40, 55, 80, 0.95);
          }

          &::placeholder {
            color: var(--text-muted);
            opacity: 0.8;
          }
        }
      }

      .selectors-container {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        justify-content: space-around;

        .dropdown-group {
          display: flex;
          flex-direction: column;
          gap: 8px;
          min-width: 220px;
          flex-grow: 1;
          max-width: 400px;

          label {
            font-weight: 500;
            font-size: 0.9em;
            color: var(--accent-color);
            opacity: 0.9;
          }

          select {
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-element);
            color: var(--text-light);
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23dfe3ee'%3E%3Cpath fill-rule='evenodd' d='M8 11.293l-4.146-4.147a.5.5 0 0 1 .708-.708L8 9.879l3.438-3.438a.5.5 0 0 1 .707.707L8 11.293z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px 12px;

            &:hover {
              border-color: var(--accent-color);
              background-color: rgba(40, 55, 80, 0.95);
            }

            &:disabled {
              opacity: 0.5;
              cursor: not-allowed;
              background-color: rgba(30, 45, 70, 0.5);
            }
          }
        }
      }
    }

    .content-area {
      width: 100%;
      background-color: var(--bg-container);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 5px 20px var(--shadow-color);
      overflow-y: auto;
      max-height: calc(100dvh - 250px);
      border: 1px solid var(--border-color);
    }

    #jsonContent {

      .loader,
      .no-results {
        text-align: center;
        padding: 30px;
        font-style: italic;
        color: var(--accent-color);
        font-size: 1.1em;
      }

      .sukta-entry {
        background-color: var(--bg-element);
        padding: 17px;
        margin-bottom: 20px;
        border-radius: 10px;
        border-left: 5px solid var(--accent-color);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        transition: transform 0.2s ease-in-out;

        &:hover {
          transform: translateY(-3px);
        }

        &:last-of-type {
          margin-bottom: 0;
        }

        .sukta-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 12px;
          flex-wrap: wrap;
          gap: 10px;

          .sukta-meta-info {
            flex-grow: 1;
          }

          /* .speech-controls and .pronounce-btn removed as TTS is gone */
        }

        .sukta-meta {
          font-size: 0.85em;
          color: var(--text-muted);
        }
      }

      .rigveda-metadata-display {
        font-size: 0.9em;
        color: var(--text-muted);
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px dashed var(--border-color);
        line-height: 1.5;
      }

      .sukta-text-content {
        font-size: 1.15em;
        line-height: 2.2;
        color: var(--text-light);

        .highlight {
          background-color: var(--accent-color);
          color: darkred;
          padding: 0.1em 0em;
          border-radius: 4px;
          font-weight: bold;
        }
      }

      .rigveda-verse {
        margin: 0;
      }
    }

    .translate-button-container {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 1001;
    }

    @media (max-width: 768px) {
      .page-container {
        padding: 15px;
      }

      .header-controls {
        padding: 15px;
        width: 90%;

        .search-area {
          flex-direction: column;
          align-items: stretch;
        }

        .selectors-container {
          flex-direction: column;

          .dropdown-group {
            min-width: 100%;
            max-width: none;
          }
        }
      }

      .content-area {
        padding: 15px;
        max-height: calc(100dvh - 220px);
        width: 92.5%;
      }
    }

    @media (max-width: 480px) {
      body {
        font-size: calc(var(--min-font-size) + 0.75vw);
      }

      .header-controls {
        h1#vedaTitle {
          font-size: 1.6em;
        }
      }

      #jsonContent {
        .sukta-text-content {
          font-size: 1.1em;
          line-height: 2.1;
        }

        .sukta-header {
          flex-direction: column;
          align-items: flex-start;
        }
      }

      .content-area {
        padding: 10px;
        max-height: calc(100dvh - 200px);
        width: 92.5%;
      }
    }
  </style>
</head>

<body>
  <div class="page-container">
    <div class="header-controls">
      <h1 id="vedaTitle">Ṛgveda Saṃhitā</h1>
      <div class="search-area">
        <input type="search" id="searchInput" placeholder="Search within Ṛgveda...">
      </div>
      <div class="selectors-container">
        <div class="dropdown-group">
          <label for="suktaSelector">Select Sūkta:</label>
          <select id="suktaSelector">
            <option value="all">All Sūktas</option>
          </select>
        </div>
      </div>
    </div>

    <div class="content-area">
      <div id="jsonContent">
        <div class="loader">Loading Ṛgveda content...</div>
      </div>
    </div>
  </div>

  <div class="translate-button-container">
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script id="rigVedaMainScript">
    const filenameToBookTitle = {
      'default_rigveda.json': 'Ṛgveda Saṃhitā'
    };

    const urlParams = new URLSearchParams(window.location.search);
    const filename = urlParams.get('filename') || 'default_rigveda.json';

    let allVedaData = [];
    let debounceTimeout;

    const jsonContentDiv = document.getElementById('jsonContent');
    const suktaSelector = document.getElementById('suktaSelector');
    const searchInput = document.getElementById('searchInput');
    const vedaTitleElement = document.getElementById('vedaTitle');

    function parseRigvedaSuktaText(rawSuktaText) {
      const lines = rawSuktaText.split('\n').map(line => line.trim()).filter(line => line.length > 0);
      let metadataHTML = '';
      const verseHTMLParts = [];
      let firstVerseFound = false;
      const metadataLinesBuffer = [];
      for (const line of lines) {
        if (!firstVerseFound && (line.includes('॥१॥') || (lines.indexOf(line) < 3 && !line.match(/[॒॑꣠]/)))) {
          if (line.includes("॥")) { firstVerseFound = true; }
          else { metadataLinesBuffer.push(line); continue; }
        }
        if (!firstVerseFound && metadataLinesBuffer.length > 0 && line.includes('॥')) { firstVerseFound = true; }
        if (firstVerseFound) {
          verseHTMLParts.push(`<p class="rigveda-verse">${line.replace(/<[^>]+>/g, '')}</p>`);
        } else if (metadataLinesBuffer.length > 0 && !firstVerseFound) { metadataLinesBuffer.push(line); }
        else if (!firstVerseFound) { metadataLinesBuffer.push(line); }
      }
      if (metadataLinesBuffer.length > 0) { metadataHTML = metadataLinesBuffer.join('<br>'); }
      if (verseHTMLParts.length === 0 && metadataHTML === '' && lines.length > 0) { metadataHTML = lines.join('<br>'); }
      const versesHTML = verseHTMLParts.join('');
      return { metadataHTML, versesHTML };
    }

    function populateSuktaSelector() {
      const suktas = [...new Set(allVedaData.map(entry => entry.sukta))].sort((a, b) => a - b);
      suktaSelector.innerHTML = '<option value="all">All Sūktas</option>';
      suktaSelector.disabled = false;
      sodukuu = suktas.forEach(suktaNum => {
        const option = document.createElement('option');
        option.value = suktaNum;
        option.innerText = `Sūkta ${suktaNum}`;
        suktaSelector.appendChild(option);
      });
    }

    function filterAndDisplayContent() {
      const selectedSukta = suktaSelector.value;
      const searchTerm = searchInput.value.trim().toLowerCase();
      jsonContentDiv.innerHTML = '<div class="loader">Filtering Ṛgveda content...</div>';

      setTimeout(() => {
        let filteredData = allVedaData;
        if (selectedSukta !== 'all') {
          filteredData = filteredData.filter(entry => entry.sukta === parseInt(selectedSukta));
        }
        if (searchTerm) {
          filteredData = filteredData.filter(entry => entry.text.toLowerCase().includes(searchTerm));
        }
        jsonContentDiv.innerHTML = '';
        if (filteredData.length === 0) {
          jsonContentDiv.innerHTML = '<p class="no-results">No Sūktas found.</p>';
          return;
        }
        const fragment = document.createDocumentFragment();
        filteredData.forEach(entry => {
          const entryDiv = document.createElement('div');
          entryDiv.className = 'sukta-entry';
          const { metadataHTML, versesHTML } = parseRigvedaSuktaText(entry.text);
          let finalVersesHTML = versesHTML;
          if (searchTerm && versesHTML) {
            const regex = new RegExp(searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
            finalVersesHTML = versesHTML.replace(regex, match => `<span class="highlight">${match}</span>`);
          }
          const displayMandala = entry.mandala || 'N/A';
          entryDiv.innerHTML = `
            <div class="sukta-header">
                <div class="sukta-meta-info">
                    <span class="sukta-meta">Maṇḍala: ${displayMandala}, Sūkta: ${entry.sukta}</span>
                </div>
                <!-- Speech controls removed -->
            </div>
            ${metadataHTML ? `<div class="rigveda-metadata-display">${metadataHTML}</div>` : ''}
            <div class="sukta-text-content">${finalVersesHTML || ''}</div>`;
          fragment.appendChild(entryDiv);
        });
        jsonContentDiv.appendChild(fragment);
      }, 50);
    }

    if (!filename) {
      jsonContentDiv.innerHTML = '<p class="no-results" style="color:red;">Error: Data file not specified.</p>';
      if (vedaTitleElement) vedaTitleElement.textContent = "Error";
    } else {
      fetch(`/DharmicData/Veda/Rigveda/${filename}`)
        .then(response => {
          if (!response.ok) throw new Error(`Fetch failed: ${response.status}`);
          return response.json();
        })
        .then(data => {
          allVedaData = data;
          const pageTitle = filenameToBookTitle[filename] || `Ṛgveda (${filename.replace('.json', '')})`;
          document.title = `${pageTitle} - Content`;
          if (vedaTitleElement) vedaTitleElement.textContent = pageTitle;
          populateSuktaSelector();
          filterAndDisplayContent();
        })
        .catch(error => {
          jsonContentDiv.innerHTML = `<p class="no-results" style="color:red;">Error loading data: ${error.message}</p>`;
          if (vedaTitleElement) vedaTitleElement.textContent = "Error Loading";
        });
    }

    suktaSelector.addEventListener('change', filterAndDisplayContent);
    searchInput.addEventListener('input', () => {
      clearTimeout(debounceTimeout);
      debounceTimeout = setTimeout(filterAndDisplayContent, 300);
    });

    window.onload = () => {
    };
  </script>
  <script src="/js/translate.js"></script>
</body>

</html>